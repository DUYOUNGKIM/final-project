<!DOCTYPE html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8" />
        <title>메인페이지</title>
        <meta name="description" content="" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <meta property="og:title" content="" />
        <meta property="og:type" content="" />
        <meta property="og:url" content="" />
        <meta property="og:image" content="" />

        <link rel="manifest" href="site.webmanifest" />
        <link rel="apple-touch-icon" href="icon.png" />
        <!-- Place favicon.ico in the root directory -->

        <link rel="stylesheet" href="css/normalize.css" />
        <link rel="stylesheet" href="css/main.css" />
        <link rel="stylesheet" href="css/menu.css" />
        <link rel="stylesheet" href="css/reset.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <meta name="theme-color" content="#fafafa" />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
            crossorigin="anonymous"
        />
        <style>
            .container {
                width: 1200px;
                /*height: 1000px;*/
                padding: 0;
                margin-top: 100px;
                /* background-color: #fffbf4; */
            }

            #recommend,
            #community {
                display: flex;
                flex-wrap: nowrap;
                grid-template-columns: repeat(4, 1fr);
                width: 1200px;
                gap: 20px;
            }
            .post {
                width: 100%;
                cursor: pointer;
            }
            .post .post-img-wrap {
                width: 285px;
                height: 218px;
                display: flex;
                justify-content: center;
                align-items: center;
                overflow: hidden;
            }
            .post .post-img-wrap img {
                width: 140%;
            }

            /* #recommend .post .post-text
            #recommend .post .post-text .title
            #recommend .post .post-text .heart-wrap
            #recommend .post .post-text .heart-wrap .heart-img-wrap */

            .top-area {
                display: flex;
                width: 100%;
                justify-content: space-between;
                margin-bottom: 30px;
            }
            .sider-title {
                font-size: 30px;
                font-weight: bold;
            }
            .post-text {
            }
            .post-text .title {
                margin-top: 10px;
                font-weight: bold;
                margin-bottom: 10px;
            }
            .post-text .count {
                font-size: 12px;
            }

            .heart-wrap {
                display: flex;
            }

            .heart-wrap .heart-img-wrap {
                width: 18px;
                height: 18px;
                margin-right: 5px;
                display: flex;
                justify-content: center;
                align-items: center;
                overflow: hidden;
            }

            .heart-wrap .heart-img-wrap img {
                width: 100%;
            }

            /* .slick-prev,
            .slick-next {
                background-color: white;
                width: 50px;
                height: 50px;
                margin-top: 100px;
                border: none;
                font-size: 20px;
            } */

            .btn-style,
            .btn-style:active,
            .btn-style:focus {
                background-color: #f46b3f;
                border: 1px solid #f46b3f;
            }

            .btn-style:hover {
                background-color: #e1572b;
                border: 1px solid #e1572b;
            }

            .tag-box {
                margin-top: 50px;
                margin-bottom: 100px;
            }

            .btn-group {
                width: 700px;
                display: flex;
                flex-wrap: wrap;
                margin: 0 auto;
            }
            .btn-group > label {
                border-radius: 0;
                margin: 10px;
                border: 1px solid #f46b3f;
                color: #f46b3f;
            }
            .btn-group > label:hover,
            .btn-check:checked + .btn-outline-primary {
                background-color: #f46b3f;
                border: 1px solid #f46b3f;
            }
        </style>
    </head>

    <body>
        <header class="menu">
            <div class="bg-line"></div>
            <div class="logo-wrap" style="cursor: pointer" onclick="moveMainPage()">
                <img class="img" src="./../static/img/logo_main.png" alt="로고" />
            </div>
            <div class="item-list">
                <a href="./template/g-1_recommend.html">코스추천</a>
                <a href="./template/h-1_communityMain.html">커뮤니티</a>
                <a href="./template/i-1_shopMain.html">쇼핑몰</a>
                <a href="./template/j-1_noticeMain.html">공지사항</a>
            </div>
            <div class="right">
                <div class="friend">
                    <div class="icon-friend" onclick="handleToggleFriendDropBox()">
                        <img class="img" src="./../static/img/icon_friends.png" />
                    </div>
                    <div class="friend-dropbox">
                        <div class="search-area">
                            <div class="mb-3">
                                <input
                                    type="text"
                                    class="form-control"
                                    id="exampleFormControlInput1"
                                    placeholder="닉네임 검색"
                                />
                            </div>
                            <div class="btn-wrap">
                                <button type="button" class="btn btn-primary search-btn">
                                    검색
                                </button>
                            </div>
                        </div>
                        <ul class="friend-list">
                            <li>
                                <div class="left">
                                    <div class="img-wrap">
                                        <img
                                            class="img"
                                            src="./../static/img/icon_profile_default.png"
                                        />
                                    </div>
                                    <p class="name">오메가오메오메</p>
                                    <button type="button" class="btn btn-link">1:1 채팅</button>
                                </div>
                            </li>
                            <li>
                                <div class="left">
                                    <div class="img-wrap">
                                        <img
                                            class="img"
                                            src="./../static/img/icon_profile_default.png"
                                        />
                                    </div>
                                    <p class="name">오메가오메오메</p>
                                    <button type="button" class="btn btn-link">1:1 채팅</button>
                                </div>
                            </li>
                            <li>
                                <div class="left">
                                    <div class="img-wrap">
                                        <img
                                            class="img"
                                            src="./../static/img/icon_profile_default.png"
                                        />
                                    </div>
                                    <p class="name">오메가오메오메</p>
                                    <button type="button" class="btn btn-link">1:1 채팅</button>
                                </div>
                            </li>
                        </ul>
                        <div class="line"></div>
                        <p class="recommend-title">추천 친구</p>
                        <ul class="friend-list">
                            <li>
                                <div class="left">
                                    <div class="img-wrap">
                                        <img
                                            class="img"
                                            src="./../static/img/icon_profile_default.png"
                                        />
                                    </div>
                                    <p class="name">오메가오메오메</p>
                                    <button type="button" class="btn btn-link">친구 추가</button>
                                </div>
                            </li>
                            <li>
                                <div class="left">
                                    <div class="img-wrap">
                                        <img
                                            class="img"
                                            src="./../static/img/icon_profile_default.png"
                                        />
                                    </div>
                                    <p class="name">오메가오메오메</p>
                                    <button type="button" class="btn btn-link">친구 추가</button>
                                </div>
                            </li>
                            <li>
                                <div class="left">
                                    <div class="img-wrap">
                                        <img
                                            class="img"
                                            src="./../static/img/icon_profile_default.png"
                                        />
                                    </div>
                                    <p class="name">오메가오메오메</p>
                                    <button type="button" class="btn btn-link">친구 추가</button>
                                </div>
                            </li>
                            <li>
                                <div class="left">
                                    <div class="img-wrap">
                                        <img
                                            class="img"
                                            src="./../static/img/icon_profile_default.png"
                                        />
                                    </div>
                                    <p class="name">오메가오메오메</p>
                                    <button type="button" class="btn btn-link">친구 추가</button>
                                </div>
                            </li>
                            <li>
                                <div class="left">
                                    <div class="img-wrap">
                                        <img
                                            class="img"
                                            src="./../static/img/icon_profile_default.png"
                                        />
                                    </div>
                                    <p class="name">오메가오메오메</p>
                                    <button type="button" class="btn btn-link">친구 추가</button>
                                </div>
                            </li>
                            <li>
                                <div class="left">
                                    <div class="img-wrap">
                                        <img
                                            class="img"
                                            src="./../static/img/icon_profile_default.png"
                                        />
                                    </div>
                                    <p class="name">오메가오메오메</p>
                                    <button type="button" class="btn btn-link">친구 추가</button>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="bell">
                    <div class="icon-bell" onclick="handleToggleBellDropBox()">
                        <img class="img" src="./../static/img/icon_bell.png" />
                    </div>
                    <div class="bell-dropbox">
                        <p>알람</p>
                        <ul>
                            <li>
                                <a href="#">공지사항 내용이 추가되었습니다 언능 확인해주세요!</a>
                            </li>
                            <li>
                                <a href="#">공지사항 내용이 추가되었습니다 언능 확인해주세요!</a>
                            </li>
                            <li>
                                <a href="#">공지사항 내용이 추가되었습니다 언능 확인해주세요!</a>
                            </li>
                            <li>
                                <a href="#">공지사항 내용이 추가되었습니다 언능 확인해주세요!</a>
                            </li>
                            <li>
                                <a href="#">공지사항 내용이 추가되었습니다 언능 확인해주세요!</a>
                            </li>
                            <li>
                                <a href="#">공지사항 내용이 추가되었습니다 언능 확인해주세요!</a>
                            </li>
                            <li>
                                <a href="#">공지사항 내용이 추가되었습니다 언능 확인해주세요!</a>
                            </li>
                            <li>
                                <a href="#">공지사항 내용이 추가되었습니다 언능 확인해주세요!</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <a id="my-profile" class="my-profile-wrap" href="./template/f-1_myPage.html">
                    <!--        <div class="img-wrap">-->
                    <!--          <img class="img" src="./../static/img/icon_profile_default.png "/>-->
                    <!--        </div>-->
                    <!--        <p class="text">나와바리나와바님</p>-->
                </a>
            </div>
        </header>
        <main class="container">
            <div class="post-slider">
                <div class="top-area">
                    <h1 class="sider-title">현재 모집중인 크루</h1>
                    <div style="display: flex; align-items: center">
                        <p style="margin-right: 10px; margin-top: 14px">
                            직접 크루를 만들어보세요!
                        </p>
                        <button
                            type="button"
                            class="btn btn-primary btn-style"
                            onclick="moveCommunityCreate()"
                        >
                            모집글 작성하기
                        </button>
                    </div>
                </div>
                <div id="community">
                    <!-- 커뮤니티 리스트 들어갈 자리 -->
                </div>
            </div>
            <div class="post-slider" style="margin-top: 50px">
                <div class="top-area">
                    <h1 class="sider-title">지금 핫한 등산코스</h1>
                </div>
                <div id="recommend">
                    <!-- 코스추천 리스트 들어갈 자리 -->
                </div>
            </div>
        </main>
        <div
            class="tag-box"
            style="width: 1200px; margin: 0 auto; margin-top: 50px; margin-bottom: 100px"
        >
            <h1 class="sider-title">관심사로 찾는 커뮤니티</h1>
            <div
                class="btn-group"
                role="group"
                aria-label="Basic checkbox toggle button group"
            ></div>
        </div>
        <!--  <p>Hello world! This is HTML5 Boilerplate.</p>-->

        <script src="js/vendor/modernizr-3.11.2.min.js"></script>
        <script src="js/plugins.js"></script>
        <script src="js/main.js"></script>

        <!-- Google Analytics: change UA-XXXXX-Y to be your site's ID. -->
        <script>
            let list = [
                { id: 1, name: "주변맛집" },
                { id: 2, name: "등산용품" },
                { id: 3, name: "등산데이트" },
                { id: 4, name: "등산친구" },
                { id: 5, name: "봄산" },
                { id: 6, name: "여름산" },
                { id: 7, name: "가을산" },
                { id: 8, name: "겨울산" },
                { id: 9, name: "안전수칙" },
                { id: 10, name: "산악회" },
                { id: 11, name: "10~20대" },
                { id: 12, name: "30~40대" },
                { id: 13, name: "50~60대" },
                { id: 14, name: "등산꿀팁" },
                { id: 15, name: "산추천" },
                { id: 16, name: "계곡추천" },
                { id: 17, name: "등린이" },
                { id: 18, name: "등산입문자" },
                { id: 19, name: "등산매니아" },
                { id: 20, name: "등산모임" },
                { id: 21, name: "1시간걸리는산" },
                { id: 22, name: "2시간걸리는산" },
                { id: 23, name: "3시간걸리는산" },
            ]
            $(document).ready(function () {
                $(".friend-dropbox").hide()
                $(".bell-dropbox").hide()
                getMenuProfile()
                for (let i = 0; i < list.length; i++) {
                    var temp = `
                        <input type="checkbox" class="btn-check" id="btncheck${i}" autoComplete="off">
                        <label class="btn btn-outline-primary" for="btncheck${i}" onclick="moveCommunityWithHashtag(${list[i].id})">'${list[i].id}' ${list[i].name} </label>
                    `
                    $(".btn-group").append(temp)
                }
                getCrewCommunityList()
                getRecommendLikeList()
            })

            function getMenuProfile() {
                var menuProfile = JSON.parse(localStorage.getItem("menuProfile"))
                console.log("menuProfile : ", menuProfile)
                var tempProfile = `
                    <div class="img-wrap">
                        <img class="img" style="width: 100%; height: auto" src=${
                            menuProfile.profileImage
                                ? menuProfile.profileImage
                                : "./../static/img/icon_profile_default.png"
                        } alt="프로필사진"/>
                    </div>
                    <p class="text">${menuProfile.nickname}님</p>
            `
                $("#my-profile").append(tempProfile)
            }

            function handleToggleBellDropBox() {
                $(".bell-dropbox").toggle()
                $(".friend-dropbox").hide()
            }

            function handleToggleFriendDropBox() {
                $(".friend-dropbox").toggle()
                $(".bell-dropbox").hide()
            }

            // $(".post-wrapper").slick({
            //     slidesToShow: 4,
            //     slidesToScroll: 1,
            //     autoplay: true,
            //     autoplaySpeed: 2000,
            // })

            // $(".slick-prev").text("<")
            // $(".slick-next").text(">")

            function getCrewCommunityList() {
                const accessToken = localStorage.getItem("accessToken")
                $.ajax({
                    type: "GET",
                    // TODO 현재 모집중인 것들이 뜨게 하는 쿼리문 추가 필요
                    url: "http://localhost:8080/boards/communities?page=0&size=4&title=&contents&nickname&hashtagId=0&chatStatus=Y",
                    beforeSend: function (xlr) {
                        xlr.setRequestHeader("Authorization", accessToken)
                    },
                    success: function (response) {
                        console.log("커뮤니티 response : ", response)
                        for (let i = 0; i < response.data.length; i++) {
                            var temp = `
                            <div class="post" onclick="moveCommunityDetail(${response.data[i].boardId})">
                                <div class="post-img-wrap">
                                    <img src=${response.data[i].imgList[0]} alt="산 이미지" />
                                </div>
                                <div class="post-text">
                                    <p class="title">${response.data[i].title}</p>
                                    <p class="count">1/5 참여중</p>
                                </div>
                            </div>
                            `
                            $("#community").append(temp)
                        }
                    },
                    error: function (response) {
                        console.log("response : ", response)
                        // console.log(
                        //     "response.responseJSON.message.substring(0, 11) : ",
                        //     response.responseJSON.message.substring(0, 11)
                        // )
                        if (response.responseJSON.message.substring(0, 11) == "JWT expired") {
                            regenerateToken()
                        }
                    },
                })
            }

            function getRecommendLikeList() {
                const accessToken = localStorage.getItem("accessToken")
                $.ajax({
                    type: "GET",
                    url: "http://localhost:8080/boards/recommends?page=0&size=4&score=0&season=&altitude=0&region=&sort=likeDesc",
                    beforeSend: function (xlr) {
                        xlr.setRequestHeader("Authorization", accessToken)
                    },
                    success: function (response) {
                        console.log("코스추천 response : ", response)
                        for (let i = 0; i < response.data.length; i++) {
                            var temp = `
                                <div class="post" onclick="moveRecommendDetail(${response.data[i].boardId})">
                                    <div class="post-img-wrap">
                                        <img src=${response.data[i].imgList[0]} alt="산 이미지" />
                                    </div>
                                    <div class="post-text">
                                        <p class="title">${response.data[i].title}</p>
                                        <div class="heart-wrap">
                                            <div class="heart-img-wrap">
                                                <img src="static/img/heart.png" alt="좋아요 하트" />
                                            </div>
                                            <p style="margin-bottom: 0; font-size: 14px">${response.data[i].likeCount}</p>
                                        </div>
                                    </div>
                                </div>
                            `
                            $("#recommend").append(temp)
                        }
                    },
                    error: function (response) {
                        console.log("response : ", response)
                        if (response.responseJSON.message.substring(0, 11) == "JWT expired") {
                            regenerateToken()
                        }
                    },
                })
            }

            function moveCommunityWithHashtag(id) {
                localStorage.setItem("hashtagId", id)
                window.location = "template/h-1_communityMain.html"
            }

            function moveCommunityDetail(id) {
                localStorage.setItem("communityId", id)
                window.location = "template/h-2_communityDetail.html"
            }
            function moveRecommendDetail(id) {
                localStorage.setItem("recommendId", id)
                window.location = "template/g-2_recommendDetail.html"
            }

            function regenerateToken() {
                var refreshToken = localStorage.getItem("refreshToken")
                $.ajax({
                    type: "POST",
                    url: "http://localhost:8080/auth/token/regenerate",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify({
                        refreshToken: refreshToken,
                    }),
                    success: function (response) {
                        localStorage.setItem("accessToken", response.accessToken)
                        localStorage.setItem("refreshToken", response.refreshToken)
                        getRecommend()
                    },
                    error: function (response) {
                        console.log("에러 : ", response)
                    },
                })
            }

            function moveCommunityCreate() {
                window.location = "./template/h-3_communityCreate.html"
            }
        </script>
    </body>
</html>
